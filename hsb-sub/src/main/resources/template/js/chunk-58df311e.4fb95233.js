(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58df311e"],{"57fd":function(e,t,o){"use strict";o("f412")},"61f7":function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));o("14d9");function i(e){if("boolean"===typeof e)return!1;if(e instanceof Array){if(0===e.length)return!0}else{if(!(e instanceof Object))return"null"===e||null==e||"undefined"===e||void 0===e||""===e;if("{}"===JSON.stringify(e))return!0}return!1}},a0ae:function(e,t,o){"use strict";o.r(t);var i=o("7a23");const r=e=>(Object(i["pushScopeId"])("data-v-4ce90e74"),e=e(),Object(i["popScopeId"])(),e),n={class:"logManage"},a={class:"timeLine"},l=["onClick"],s={class:"edit-panel"},c=r(()=>Object(i["createElementVNode"])("span",{class:"edit-item-title"},"版本号：",-1)),d={style:{"line-height":"32px","padding-left":"10px","font-size":"13px","letter-spacing":"2px",color:"red"}},h=r(()=>Object(i["createElementVNode"])("span",{class:"edit-item-title"},"程序包：",-1)),g={class:"el-upload__text"},p={ref:"mdEditorContainer",style:{width:"100%",height:"100%"}};function m(e,t,o,r,m,f){const u=Object(i["resolveComponent"])("el-timeline-item"),b=Object(i["resolveComponent"])("el-timeline"),O=Object(i["resolveComponent"])("el-input"),j=Object(i["resolveComponent"])("el-col"),I=Object(i["resolveComponent"])("el-row"),v=Object(i["resolveComponent"])("el-progress"),w=Object(i["resolveComponent"])("el-upload"),V=Object(i["resolveComponent"])("el-button"),C=Object(i["resolveComponent"])("v-md-editor");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",n,[Object(i["createElementVNode"])("div",a,[Object(i["createVNode"])(b,null,{default:Object(i["withCtx"])(()=>[(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],null,Object(i["renderList"])(m.logList,(e,t)=>(Object(i["openBlock"])(),Object(i["createBlock"])(u,{key:t,hollow:e.hollow,type:e.type,timestamp:e.timestamp},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("span",{class:"timeline-item",onClick:t=>f.activeTimelineItem(e)},Object(i["toDisplayString"])(e.title),9,l)]),_:2},1032,["hollow","type","timestamp"]))),128))]),_:1})]),Object(i["createElementVNode"])("div",s,[Object(i["createVNode"])(I,null,{default:Object(i["withCtx"])(()=>[c,Object(i["createVNode"])(j,{span:10},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(O,{modelValue:m.logInfo.programVersion,"onUpdate:modelValue":t[0]||(t[0]=e=>m.logInfo.programVersion=e),placeholder:"输入版本号",disabled:m.isEditMode,"suffix-icon":e.Calendar,onBlur:f.checkVersion},null,8,["modelValue","disabled","suffix-icon","onBlur"])]),_:1}),Object(i["withDirectives"])(Object(i["createElementVNode"])("span",d,"版本号已经存在！！！",512),[[i["vShow"],m.showError]])]),_:1}),Object(i["createVNode"])(I,null,{default:Object(i["withCtx"])(()=>[h,Object(i["createVNode"])(j,{span:10},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(w,{class:"edit-item-upload",drag:"",action:"",ref:"uploadProgram","http-request":f.doUploadFile,multiple:"false",accept:".zip, .rar","on-exceed":f.handleExceed,"on-remove":f.onRemoveFile,"before-remove":f.beforeRemoveFile,"file-list":m.programFiles,"onUpdate:file-list":t[1]||(t[1]=e=>m.programFiles=e),"auto-upload":!0,disabled:void 0===m.logInfo.programVersion||""===m.logInfo.programVersion,limit:"1"},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("div",g,Object(i["toDisplayString"])(void 0===m.logInfo.programVersion||""===m.logInfo.programVersion?"请先输入版本号":"拖动文件到这里 或者 点击上传"),1),Object(i["withDirectives"])(Object(i["createVNode"])(v,{"stroke-linecap":"square",percentage:this.logInfo.uploadPercentage},null,8,["percentage"]),[[i["vShow"],this.showProgress]])]),_:1},8,["http-request","on-exceed","on-remove","before-remove","file-list","disabled"])]),_:1}),Object(i["createVNode"])(j,{push:8,span:2},{default:Object(i["withCtx"])(()=>[Object(i["withDirectives"])(Object(i["createVNode"])(V,{type:"danger",style:{width:"100%","max-width":"108px"},onClick:f.cancelEdit},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])("取消")]),_:1},8,["onClick"]),[[i["vShow"],m.isEditMode]])]),_:1}),Object(i["createVNode"])(j,{push:8,span:2},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(V,{type:"primary",style:{width:"100%","max-width":"108px","margin-left":"5px"},onClick:f.submitLogInfo,disabled:m.showError},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])("提交")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),Object(i["createVNode"])(I,{style:{height:"calc(100% - 109px)"}},{default:Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("div",p,[Object(i["createVNode"])(C,{modelValue:m.logInfo.logMd,"onUpdate:modelValue":t[2]||(t[2]=e=>m.logInfo.logMd=e),placeholder:"请编辑升级日志...",height:m.editorHeight,onChange:f.changeMd,"disabled-menus":[],onUploadImage:f.handleUploadImage},null,8,["modelValue","height","onChange","onUploadImage"])],512)]),_:1})])])}o("14d9");var f=o("cee4"),u=o("c9a1"),b=(e,t)=>{let o=e.__vccOpts||e;for(let[i,r]of t)o[i]=r;return o};var O={name:"Delete"},j={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},I=Object(i["createElementVNode"])("path",{fill:"currentColor",d:"M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32V256zm448-64v-64H416v64h192zM224 896h576V256H224v640zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32zm192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32z"},null,-1),v=[I];function w(e,t,o,r,n,a){return Object(i["openBlock"])(),Object(i["createElementBlock"])("svg",j,v)}var V=b(O,[["render",w],["__file","delete.vue"]]);var C=o("b775");function x(e){return Object(C["a"])({url:"/file/uploadImg",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}})}function E(e,t,o,i){return Object(C["a"])({url:"/file/uploadProgramFile/"+t,method:"post",data:e,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let t=e.loaded/e.total*100|0;o.uploadPercentage=t},timeout:36e4,cancelToken:i.token})}var P=o("8916"),y=o("61f7"),k={name:"logManage",data(){return{isEditMode:!1,showError:!1,cancelSource:f["a"].CancelToken.source(),screenWidth:"",screenHeight:"",showProgress:!1,currentOp:"",logInfo:{uploadPercentage:0},activeTimelineItemInfo:{},programFiles:[],editorHeight:"700px",logList:[]}},components:{},methods:{activeTimelineItem(e){this.activeTimelineItemInfo.type="info",this.activeTimelineItemInfo.hollow=!0,this.activeTimelineItemInfo=e,this.activeTimelineItemInfo.hollow=!1,this.activeTimelineItemInfo.type="primary",Object(P["f"])(e.id).then(e=>{this.logInfo=e.data,this.$refs["uploadProgram"].clearFiles(),this.isEditMode=!0,this.showError=!1,Object(y["a"])(this.logInfo.programFileUrl)?(this.logInfo.uploadPercentage=0,this.showProgress=!1):(this.logInfo.uploadPercentage=100,this.showProgress=!0,this.$nextTick(()=>{this.programFiles.push({name:this.logInfo.programFileUrl.split("/").pop(),url:this.logInfo.programFileUrl})}))})},checkVersion(){this.isEditMode||Object(y["a"])(this.logInfo.programVersion)||Object(P["c"])(this.logInfo.programVersion).then(e=>{this.showError=e.data})},handleExceed(){this.$message.error("当前限制选择 1 个文件，请删除后继续上传！")},beforeRemoveFile(){return u["a"].confirm("删除文件后将重新上传文件，是否删除?","Warning",{type:"warning",icon:Object(i["markRaw"])(V)}).then(()=>!0,()=>!1)},onRemoveFile(){0!=this.logInfo.uploadPercentage&&100!=this.logInfo.uploadPercentage&&this.cancelSource.cancel(),this.logInfo.uploadPercentage=0,this.logInfo.programFileUrl="",this.showProgress=!1},doUploadFile(e){if(this.showProgress=!0,Object(y["a"])(this.logInfo.programVersion))return void this.$message.error("未输入程序版本号，无法上传！！！");const t=new FormData;t.append("programFile",e.file),this.cancelSource=f["a"].CancelToken.source(),E(t,this.logInfo.programVersion,this.logInfo,this.cancelSource).then(e=>{this.$message.success("上传成功"),this.logInfo.programFileUrl=e.data}).catch(e=>{f["a"].isCancel(e)?this.$message.info("上传已被取消"):this.$message.error("上传失败"+e),this.logInfo.uploadPercentage=0,this.showProgress=!1})},changeMd(e,t){this.logInfo.logHtml=t},handleUploadImage(e,t,o){let i=new FormData;i.append("file",o[0]),x(i).then(e=>{t({url:e.data,desc:"desc"})})},submitLogInfo(){if(0==this.logInfo.uploadPercentage||100==this.logInfo.uploadPercentage)if(Object(y["a"])(this.logInfo.programVersion)||Object(y["a"])(this.logInfo.logMd))this.$message.error("版本号或升级日志不能为空！！！");else if(this.logInfo.modifierId=this.currentOp,this.isEditMode){const e=this.logInfo.id;Object(y["a"])(e)&&this.$message.error("数据异常无法更新"),Object(P["g"])(this.logInfo,e).then(e=>{e.data&&(this.$message.success("更新成功"),this.resetPage())})}else Object(P["a"])(this.logInfo).then(e=>{e.data&&(this.$message.success("新增成功"),this.resetPage(),this.queryLogPreList())});else this.$message.error("文件上传中无法提交！！！")},cancelEdit(){0!=this.logInfo.uploadPercentage&&100!=this.logInfo.uploadPercentage&&this.cancelSource.cancel(),this.resetPage()},resetPage(){this.isEditMode=!1,this.logInfo={uploadPercentage:0},this.showProgress=!1,this.programFiles=[],this.activeTimelineItemInfo.type="info",this.activeTimelineItemInfo.hollow=!0,this.activeTimelineItemInfo={}},queryLogPreList(){Object(P["d"])().then(e=>{const t=e.data;this.logList=[],t.forEach(e=>{let t={type:"info",hollow:!0,title:e.programVersion,id:e.id};this.logList.push(t)})})}},mounted(){this.currentOp=this.$route.query.authCode,this.editorHeight=this.$refs.mdEditorContainer.clientHeight-36+"px",window.onresize=()=>(()=>{this.screenWidth=document.body.clientWidth,this.screenHeight=document.body.clientHeight,this.editorHeight=this.$refs.mdEditorContainer.clientHeight-36+"px"})(),this.queryLogPreList()},watch:{screenWidth(){this.editorHeight=this.$refs.mdEditorContainer.clientHeight-36+"px"}}},N=(o("57fd"),o("6b0d")),F=o.n(N);const _=F()(k,[["render",m],["__scopeId","data-v-4ce90e74"]]);t["default"]=_},f412:function(e,t,o){}}]);